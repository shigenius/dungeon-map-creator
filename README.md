# 3D ダンジョンマップクリエイター

Web ベースの3Dダンジョン RPG 用マップエディタです。直感的な2Dグリッドエディタを使用してダンジョンマップを作成し、3Dプレビューで確認できます。

## 機能

### ✨ 主要機能
- **グリッドベース2Dマップエディタ** - HTML5 Canvas を使用した高精度な座標計算
- **マルチレイヤーシステム** - 床、壁、イベント、装飾の個別編集
- **リアルタイム編集** - ズーム（10%-400%）、グリッド表示切り替え
- **アンドゥ・リドゥ機能** - 50段階の履歴管理
- **包括的ID管理システム** - 全オブジェクトの重複チェック付きID編集

### 🎮 描画ツール
- ペンツール、矩形ツール、塗りつぶし、スポイト、消しゴム
- Shiftキー修飾子による高度な操作
- バッチセル更新によるパフォーマンス最適化

### 🏗️ テンプレートシステム
- カテゴリ別テンプレート管理（部屋、廊下、交差点、トラップ等）
- テンプレート回転機能（0°, 90°, 180°, 270°）
- 範囲選択による独自テンプレート作成
- フルマップテンプレート対応

### ⚙️ イベントシステム
- 10+種類のイベントタイプ（宝箱、NPC、階段、敵等）
- 包括的なトリガーシステム（自動、接触、アイテム使用等）
- 複雑なアクションチェーンと条件分岐
- フラグベースの状態管理

### 🎨 カスタマイズ
- カスタム床・壁タイプの作成
- エフェクトと動作設定
- カスタムプロパティ対応
- 装飾システム

### 📊 データ管理
- JSON インポート/エクスポート
- Redux 状態管理
- 階層データモデル（ダンジョン → フロア → セル）
- マップ検証機能

## 技術スタック

- **フロントエンド**: React 18+ with TypeScript
- **ビルドツール**: Vite
- **状態管理**: Redux Toolkit
- **UIフレームワーク**: Material-UI (MUI) with dark theme
- **3Dレンダリング**: Three.js（基本実装済み）
- **テスト**: Playwright (E2E), Vitest (単体テスト)

## セットアップ

### 必要なもの
- Node.js 18+ 
- npm または yarn

### インストール

```bash
# リポジトリをクローン
git clone <repository-url>
cd dungeon-map-creator

# 依存関係をインストール
npm install
```

## 開発環境

### 開発サーバー起動
```bash
npm run dev
```
開発サーバーが http://localhost:3000 で起動します。

### ビルド
```bash
# プロダクションビルド
npm run build

# ビルド結果のプレビュー
npm run preview
```

### テスト実行
```bash
# 単体テスト
npm run test:unit

# カバレッジ付き単体テスト
npm run test:coverage

# E2Eテスト
npm run test:e2e

# 全テスト実行
npm run test:all
```

### コード品質チェック
```bash
# Lint実行
npm run lint

# TypeScriptチェック
npm run build
```

## 使用方法

### 基本操作
1. **新規プロジェクト作成**: アプリケーション起動時に新規プロジェクト作成ダイアログが表示されます
2. **ツール選択**: ツールバーから描画ツールを選択（キーボードショートカット: 1-5）
3. **レイヤー切り替え**: 床、壁、イベント、装飾レイヤーを切り替え（キーボードショートカット: F, W, E, D）
4. **マップ編集**: キャンバス上でクリック・ドラッグして編集

### キーボードショートカット
- **ツール選択**: 1(ペン), 2(矩形), 3(塗りつぶし), 4(スポイト), 5(消しゴム)
- **レイヤー**: F(床), W(壁), E(イベント), D(装飾), Tab(レイヤー循環)
- **表示**: Ctrl+G(グリッド), Ctrl++/-(ズーム), Ctrl+0(ズームリセット)
- **編集**: Ctrl+Z(アンドゥ), Ctrl+Y(リドゥ), Ctrl+S(保存)
- **テンプレート**: Q(左回転), R(右回転), Enter(範囲選択確定)

### ファイル操作
- **保存**: ファイルメニュー → 保存（JSONファイルとしてダウンロード）
- **読み込み**: ファイルメニュー → 開く（JSONファイルをアップロード）

## アーキテクチャ

### コンポーネント構造
```
App.tsx                     # メインアプリケーション
├── MenuBar.tsx            # メニューバー（ファイル操作等）
├── ToolBar.tsx            # ツールバー（描画ツール選択）
├── MainCanvas.tsx         # メインキャンバス（2D/3D切り替え）
│   ├── MapEditor2D.tsx    # 2Dマップエディタ
│   └── MapEditor3D.tsx    # 3Dプレビュー（準備済み）
├── LeftPanel.tsx          # 左パネル（レイヤー、オブジェクト一覧）
├── RightPanel.tsx         # 右パネル（プロパティ、テンプレート）
└── BottomPanel.tsx        # ボトムパネル（座標、ズーム情報）
```

### データフロー
```
ユーザー操作 → Redux Actions → State 更新 → Canvas 再描画
キーボードショートカット → 直接 Redux Dispatch
ホバーイベント → editorSlice → リアルタイムUI更新
```

### 状態管理
- **mapSlice**: ダンジョンデータ、セル変更、履歴管理
- **editorSlice**: UI状態（ツール、レイヤー、ズーム、ビューモード）

## パフォーマンス制約

- 最大マップサイズ: 100×100×10フロア
- フロアあたり最大イベント数: 1000
- 最大ファイルサイズ: 50MB
- 同時編集: 単一フロアのみ

## 貢献

### 開発ガイドライン
1. TypeScript型安全性を維持
2. ESLint設定に従う
3. コンポーネントテスト実装
4. E2Eテストでユーザーフロー確認
5. CLAUDE.md の指示に従う

### コミット規約
```bash
git commit -m "feat: 新機能追加
fix: バグ修正  
chore: 環境設定変更
docs: ドキュメント更新"
```

## ライセンス

このプロジェクトは [MIT ライセンス](LICENSE) の下で公開されています。

## サポート

問題や質問がある場合は、GitHubのIssuesまたはDiscussionsをご利用ください。

---

**開発者向け補足**:
- 詳細な開発ガイドラインは `CLAUDE.md` を参照
- 手動テスト手順は `MANUAL_TEST_INSTRUCTIONS.md` を参照
- パフォーマンス改善やTDD開発プロセスについてはCLAUDE.mdを確認
